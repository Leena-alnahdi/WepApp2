@{
    Layout = "~/Views/Shared/_LayoutReports.cshtml";
    ViewData["Title"] = "إنشاء تقرير مخصص";
}

@section Styles {
    <link rel="stylesheet" href="~/css/Gruop3Style.css" />
}

<div class="customreport-main-container mt-5">
    <h2 class="customreport-section-title">إنشاء تقرير مخصص</h2>

    <form method="post" asp-action="GenerateCustomReport" asp-controller="Reports">
        <div class="mb-3">
            <label class="form-label customreport-form-label">عنوان التقرير</label>
            <input type="text" name="ReportTitle" class="form-control" placeholder="تقرير" required />
        </div>

        <div class="mb-3">
            <label class="form-label customreport-form-label">نوع التقرير</label>
            <select name="ReportType" class="form-select" id="customReportTypeSelect" onchange="toggleCustomReportFields()" required>
                <option value="">-- اختر نوع التقرير --</option>
                <option value="Users">تقرير المستخدمين</option>
                <option value="Devices">تقرير الأجهزة</option>
                <option value="Services">تقرير الخدمات</option>
                <option value="Requests">تقرير الطلبات</option>
            </select>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label class="form-label customreport-form-label">من تاريخ</label>
                <input type="date" name="FromDate" class="form-control" required />
            </div>
            <div class="col-md-6 mb-3">
                <label class="form-label customreport-form-label">إلى تاريخ</label>
                <input type="date" name="ToDate" class="form-control" required />
            </div>
        </div>

        <div class="mt-4 customreport-fields-wrapper">
            <label class="form-label customreport-form-label d-block mb-2">الحقول المطلوبة</label>
            <div id="selectAllContainer"></div>
            <div id="customReportFieldsContainer" class="customreport-fields-container">
                <!-- سيتم تعبئة هذه الحقول بواسطة JavaScript -->
            </div>
        </div>

        <div class="text-center">
            <div class="customreport-action-buttons">
                <button type="submit" class="btn btn-success">إنشاء التقرير</button>
                <a asp-controller="Reports" asp-action="AllReports" class="btn btn-outline-secondary">العودة</a>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        const customReportFields = {
            Users: [
                "الاسم",
                "اسم المستخدم",
                "البريد الإلكتروني",
                "رقم الجوال",
                "الجهة",
                "القسم",
                "نوع المستخدم",
                "الحالة"
            ],
            Devices: [
                "اسم الجهاز",
                "نوع الجهاز",
                "الحالة",
                "القسم",
                "آخر صيانة"
            ],
            Services: [
                "اسم الخدمة",
                "نوع الخدمة",
                "اسم مقدم الطلب",
                "الحالة",
                "وقت الطلب"
            ],
            Requests: [
                "نوع الطلب",
                "المستفيد",
                "الجهاز",
                "التاريخ",
                "الوقت",
                "المشرف المسند",
                "الحالة"
            ]
        };

        function toggleCustomReportFields() {
            const type = document.getElementById("customReportTypeSelect").value;
            const container = document.getElementById("customReportFieldsContainer");
            container.innerHTML = "";

            if (customReportFields[type]) {
                // Add animation to fields appearance
                container.style.opacity = "0";

                customReportFields[type].forEach((field, index) => {
                    const checkboxId = `customReportField_${index}`;
                    container.innerHTML += `
                        <div class="customreport-form-check">
                            <input class="form-check-input" type="checkbox" name="SelectedFields" value="${field}" id="${checkboxId}" checked>
                            <label class="form-check-label" for="${checkboxId}">${field}</label>
                        </div>`;
                });

                // Fade in animation
                setTimeout(() => {
                    container.style.transition = "opacity 0.3s ease-in";
                    container.style.opacity = "1";
                }, 100);
            }
        }

        // Initialize on page load if a type is already selected
        document.addEventListener('DOMContentLoaded', function() {
            const selectedType = document.getElementById("customReportTypeSelect").value;
            if (selectedType) {
                toggleCustomReportFields();
            }
        });
    </script>
}