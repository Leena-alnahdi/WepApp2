@{
    ViewBag.Title = "صفحة المشرف";
}

<!-- ربط ملف CSS -->
<link rel="stylesheet" href="~/css/Gruop3Style.css" />

<h2 class="mb-4">إدارة الطلبات</h2>
<table id="requestsTable" class="table table-hover">
    <thead>
        <tr>
            <th>الطلب</th>
            <th>نوع الطلب</th>
            <th>اسم المستخدم</th>
            <th>التاريخ</th>
            <th>الحالة</th>
            <th>الإجراءات</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>طابعة ثلاثية الأبعاد</td>
            <td>إعارة</td>
            <td>@@techGuru_22</td>
            <td>2025-06-20</td>
            <td class="status">في الانتظار</td>
            <td class="actions">
                <button class="supervisor-approve-btn btn btn-success">موافقة</button>
                <button class="supervisor-reject-btn btn btn-danger">رفض</button>
            </td>
        </tr>
        <tr>
            <td>نظارة الواقع الافتراضي</td>
            <td>استخدام</td>
            <td>@@VR_Explorer</td>
            <td>2025-06-21</td>
            <td class="status">في الانتظار</td>
            <td class="actions">
                <button class="supervisor-approve-btn btn btn-success">موافقة</button>
                <button class="supervisor-reject-btn btn btn-danger">رفض</button>
            </td>
        </tr>
        <tr>
            <td>استشارة تقنية</td>
            <td>استشارة</td>
            <td>@@CodeMaster_99</td>
            <td>2025-06-22</td>
            <td class="status">في الانتظار</td>
            <td class="actions">
                <button class="supervisor-approve-btn btn btn-success">موافقة</button>
                <button class="supervisor-reject-btn btn btn-danger">رفض</button>
            </td>
        </tr>
    </tbody>
</table>

<!-- Modal Overlay -->
<div class="supervisor-overlay" id="overlay"></div>

<!-- Reject Modal -->
<div class="supervisor-reject-modal" id="rejectModal">
    <h3 class="mb-3">رفض الطلب</h3>
    <label for="rejectReason">سبب الرفض *</label>
    <textarea id="rejectReason" rows="4" class="form-control mt-2" placeholder="اكتب سبب رفض الطلب..."></textarea>
    <div class="mt-3 text-start">
        <button onclick="confirmReject()" class="btn btn-danger">تأكيد الرفض</button>
        <button onclick="closeModal()" class="btn btn-secondary me-2">إغلاق</button>
    </div>
</div>

@section Scripts {
    <script>
        let selectedRow;

        document.querySelectorAll(".supervisor-approve-btn").forEach(btn => {
            btn.addEventListener("click", function () {
                const row = this.closest("tr");
                row.querySelector(".status").textContent = "موافق عليه";
                row.querySelector(".status").style.color = "#16a34a";
                row.querySelector(".actions").innerHTML = "تم الإجراء";
            });
        });

        document.querySelectorAll(".supervisor-reject-btn").forEach(btn => {
            btn.addEventListener("click", function () {
                selectedRow = this.closest("tr");
                document.getElementById("rejectModal").style.display = "block";
                document.getElementById("overlay").style.display = "block";
            });
        });

        function confirmReject() {
            const reason = document.getElementById("rejectReason").value.trim();
            if (reason === "") {
                alert("يرجى إدخال سبب الرفض.");
                return;
            }
            selectedRow.querySelector(".status").textContent = "مرفوض";
            selectedRow.querySelector(".status").style.color = "#dc2626";
            selectedRow.querySelector(".actions").innerHTML = "تم الإجراء";
            closeModal();
        }

        function closeModal() {
            document.getElementById("rejectModal").style.display = "none";
            document.getElementById("overlay").style.display = "none";
            document.getElementById("rejectReason").value = "";
        }

        document.getElementById("overlay").addEventListener("click", closeModal);
    </script>
}
